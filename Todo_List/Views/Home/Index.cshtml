<div class="modal fade" id="deleteEntityModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="deleteEntityModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 460px; min-width: 307px; width:fit-content;">
        <div class="modal-content">
            <div class="modal-body">
                <span class="form-subtitle" id="modal-content-text"></span>
            </div>
            <div class="modal-footer">
                <button class="violet-button" id="confirmDelete" type="button" style="height:40px; background-color: #c95252;">Usuń zadanie</button>
                <button class="violet-button" id="denyDelete" type="button" style="margin-left:10px; height:40px;">Anuluj</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="completeTaskModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="completeTaskModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 460px; min-width: 307px; width:fit-content;">
        <div class="modal-content">
            <div class="modal-body">
                <span class="form-subtitle" id="finish-modal-content-text">Czy chcesz zakończyć zadanie?<br><br><small>Po zakończeniu zadania opcja edycji i usunięcia zostanie zablokowana.</small></span>
            </div>
            <div class="modal-footer">
                <button class="violet-button" id="confirmComplete" type="button" style="height:40px; background-color: #36953b;">Zakończ zadanie</button>
                <button class="violet-button" id="denyComplete" type="button" style="margin-left:10px; height:40px;">Anuluj</button>
            </div>
        </div>
    </div>
</div>

<div class="content-container">
    <div class="tab-content" id="category-tab-content">
        <div class="tab-pane show active" id="today" aria-labelledby="today-tab">
            <div class="today-container list-container">
                <div class="options-header">
                </div>
                <div class="list-header">
                    <div class="list-header-left">
                        <button class="add-new-button violet-button" type="button" onclick="openCreateTaskWindow()">Dodaj nowe</button>
                    </div>
                    <div class="search-for-todays-task">
                        <input class="search-for todays-task-search" placeholder="Wyszukaj zadanie" />
                    </div>
                </div>
                <div class="list-content">
                    <div class="table-responsive">
                        <table class="table table-borderless" id="todays-tasks-table">
                            <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th scope="col">Nazwa</th>
                                    <th scope="col">Czas do</th>
                                    <th scope="col">Przypomnienie</th>
                                    <th scope="col">Priorytet</th>
                                    <th class="centered-cell" scope="col" style="min-width: 175px;">Opcje</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="add-new-task options-container" style="display:none;">
                <div class="option-content">
                    <div class="options-header">
                        <div class="previous-page" style="flex:1;">
                            <button class="violet-button" type="button" style="display: flex; align-items:center;" onclick="goBackToTodaysList()">
                                <span class="arrow-back" style="max-width:24px;"><img src="~/icons/previous.png" /></span>
                                <span>Powrót</span>
                            </button>
                        </div>
                        <div class="option-name" style="flex:auto; text-align:center;">
                            <span class="opion-name-placeholder" id="todays-input-window-title">Nowe zadanie</span>
                        </div>
                        <div style="flex:1;"></div>
                    </div>
                    <hr />
                    <form class="options-form todays-options-form" id="add-edit-todays-task-form">
                        <div class="basic-data">
                            <span class="form-subtitle">Podstawowe dane</span>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col">
                                        <label for="todays-task-name">Nazwa zadania *</label>
                                        <input type="text" class="form-input" id="todays-task-name" required maxlength="30" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label for="todays-task-priority">Priorytet</label>
                                        <select class="task-priority" id="todays-task-priority">
                                            <option value="-1" selected>Brak priorytetu</option>
                                            <option value="0" >Niski</option>
                                            <option value="1" >Średni</option>
                                            <option value="2" >Wysoki</option>
                                            <option value="3" >Najwyższy</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label for="todays-task-notes">Notatki</label>
                                        <textarea class="form-input" id="todays-task-notes" rows="3" maxlength="120" spellcheck="false"></textarea>
                                        <div class="symbol-counter" style="margin-top: 0.25rem; text-align: right" id="symbolCounterAdd">&nbsp</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="timeframes">
                            <span class="form-subtitle">Ramy czasowe</span>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col">
                                        <label for="todays-start-date">Data zakończenia</label>
                                        <input type="datetime-local" class="datetime-input" id="todays-start-date" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="recurrence">
                            <span class="form-subtitle">Powtarzalność zadania</span>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col">
                                        <label for="todays-recurrence-unit">Jednostka czasu</label>
                                        <select class="recurrence-unit" id="todays-recurrence-unit" disabled>
                                            <option value="-1" selected>Nie powtarzaj</option>
                                            <option value="0">Dni</option>
                                            <option value="1">Tygodnie</option>
                                            <option value="2">Miesiące</option>
                                            <option value="3">Lata</option>
                                        </select>
                                    </div>
                                    <div class="col">
                                        <label for="todays-recurrence-interval">Interwał czasu</label>
                                        <input type="text" class="form-input" id="todays-recurrence-interval" disabled/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label for="todays-reccur-start">Powtarzaj od</label>
                                        <input type="date" class="datetime-input" id="todays-reccur-start" disabled />
                                    </div>
                                    <div class="col">
                                        <label for="todays-reccur-until">Powtarzaj do</label>
                                        <input type="date" class="datetime-input" id="todays-reccur-until" disabled/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="reminder" style="margin-bottom:20px">
                            <span class="form-subtitle">Przypomnienie</span>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col">
                                        <label for="todays-reminder-date">Data przypomnienia</label>
                                        <input type="datetime-local" class="datetime-input" id="todays-reminder-date" disabled />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="justify-content-center d-flex">
                            <button type="submit" class="violet-button" id="createOrEditTodaysButton"></button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="todays-task-details-container options-container" style="margin: 20px; display: none;">
                <div class="option-content" style="max-width: 600px;">
                    <div class="options-header">
                        <div class="previous-page" style="flex:1;">
                            <button class="violet-button" id="todays-task-details-previous-button" type="button" style="display: flex; align-items:center;" onclick="goBackToTodaysList()">
                                <span class="arrow-back" style="max-width:24px;"><img src="/icons/previous.png"></span>
                                <span>Powrót</span>
                            </button>
                        </div>
                        <div class="option-name" style="flex:auto; text-align:center;">
                            <span class="opion-name-placeholder" id="todays-details-window-title">Zadanie</span>
                        </div>
                        <div style="flex:1;"></div>
                    </div>
                    <hr />
                    <div class="todays-details-content-container" style="padding: 10px 30px 30px 30px;">
                        <div class="basic-data-details" style="margin-bottom: 20px">
                            <span class="form-subtitle">Podstawowe dane</span>
                            <div class="form-group" style="margin-top: 20px;">
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="todays-detail-label">Id:</label>
                                        <span class="details-span" id="todays-id-detail"></span>
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="todays-detail-label">Nazwa zadania:</label>
                                        <span class="details-span" id="todays-name-detail"></span>
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="todays-detail-label">Notatki:</label>
                                        <span class="details-span" id="todays-notes-detail"></span>
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="todays-detail-label">Priorytet:</label>
                                        <span class="details-span" id="todays-priority-detail"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="timeframes-details" style="margin-bottom: 20px">
                            <span class="form-subtitle">Ramy czasowe</span>
                            <div class="form-group" style="margin-top: 20px;">
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="todays-detail-label">Data zakończenia:</label>
                                        <span class="details-span" id="todays-due-date-detail"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="recurrence-details" style="margin-bottom: 20px">
                            <span class="form-subtitle">Powtarzalność zadania</span>
                            <div class="form-group" style="margin-top: 20px;">
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="todays-detail-label">Jednostka czasu:</label>
                                        <span class="details-span" id="todays-recurrence-unit-detail"></span>
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="todays-detail-label">Interwał:</label>
                                        <span class="details-span" id="todays-recurrence-interval-detail"></span>
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="todays-detail-label">Początek powtarzania:</label>
                                        <span class="details-span" id="todays-recur-start-detail"></span>
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="todays-detail-label">Koniec powtarzania:</label>
                                        <span class="details-span" id="todays-recur-stop-detail"></span>
                                    </div>
                                </div>
                            </div>
                            <hr />
                        </div>
                        <div class="reminder-details" style="margin-bottom: 20px">
                            <span class="form-subtitle">Przypomnienie</span>
                            <div class="form-group" style="margin-top: 20px;">
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="todays-detail-label">Data przypomnienia:</label>
                                        <span class="details-span" id="todays-reminder-detail"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane" id="calendar" aria-labelledby="calendar-tab">
            <div class="calendar-window" style="margin:40px;">
                <div id='calendar-render'></div>
            </div>
            <div class="certain-days-container list-container" style="display:none;">
                <div class="options-header">
                </div>
                <div class="list-header">
                    <div class="list-header-left" style="display: flex;">
                        <button class="go-back-to-calendar-button violet-button" type="button" onclick="goBackToCalendar()" style="margin-right: 20px;">Wróć do kalendarza</button>
                        <button class="add-new-button violet-button" type="button" id="certain-new-button" onclick="openCreateTaskWindowCertain()" style="display:none;">Dodaj nowe</button>
                    </div>
                    <div class="search-for-certain-days-task">
                        <input class="search-for certain-days-task-search" placeholder="Wyszukaj zadanie" />
                    </div>
                </div>
                <div class="list-content">
                    <div class="table-responsive">
                        <table class="table table-borderless" id="certain-days-tasks-table">
                            <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th scope="col">Nazwa</th>
                                    <th scope="col">Czas do</th>
                                    <th scope="col">Przypomnienie</th>
                                    <th scope="col">Priorytet</th>
                                    <th class="centered-cell" scope="col" style="min-width: 175px;">Opcje</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="add-new-task-certain-days options-container" style="display:none;">
                <div class="option-content">
                    <div class="options-header">
                        <div class="previous-page" style="flex:1;">
                            <button class="violet-button" type="button" style="display: flex; align-items:center;" onclick="goBackToCertainDaysList()">
                                <span class="arrow-back" style="max-width:24px;"><img src="~/icons/previous.png" /></span>
                                <span>Powrót</span>
                            </button>
                        </div>
                        <div class="option-name" style="flex:auto; text-align:center;">
                            <span class="opion-name-placeholder" id="certain-days-input-window-title">Nowe zadanie</span>
                        </div>
                        <div style="flex:1;"></div>
                    </div>
                    <hr />
                    <form class="options-form certain-days-options-form" id="add-edit-certain-days-task-form">
                        <div class="basic-data">
                            <span class="form-subtitle">Podstawowe dane</span>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col">
                                        <label for="certain-days-task-name">Nazwa zadania *</label>
                                        <input type="text" class="form-input" id="certain-days-task-name" required maxlength="30" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label for="certain-days-task-priority">Priorytet</label>
                                        <select class="task-priority" id="certain-days-task-priority">
                                            <option value="-1" selected>Brak priorytetu</option>
                                            <option value="0" >Niski</option>
                                            <option value="1" >Średni</option>
                                            <option value="2" >Wysoki</option>
                                            <option value="3" >Najwyższy</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label for="certain-days-task-notes">Notatki</label>
                                        <textarea class="form-input" id="certain-days-task-notes" rows="3" maxlength="120" spellcheck="false"></textarea>
                                        <div class="symbol-counter" style="margin-top: 0.25rem; text-align: right" id="symbolCounterAdd">&nbsp</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="timeframes">
                            <span class="form-subtitle">Ramy czasowe</span>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col">
                                        <label for="certain-days-start-date">Data zakończenia</label>
                                        <input type="datetime-local" class="datetime-input" id="certain-days-start-date" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="recurrence">
                            <span class="form-subtitle">Powtarzalność zadania</span>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col">
                                        <label for="certain-days-recurrence-unit">Jednostka czasu</label>
                                        <select class="recurrence-unit" id="certain-days-recurrence-unit" disabled>
                                            <option value="-1" selected>Nie powtarzaj</option>
                                            <option value="0">Dni</option>
                                            <option value="1">Tygodnie</option>
                                            <option value="2">Miesiące</option>
                                            <option value="3">Lata</option>
                                        </select>
                                    </div>
                                    <div class="col">
                                        <label for="certain-days-recurrence-interval">Interwał czasu</label>
                                        <input type="text" class="form-input" id="certain-days-recurrence-interval" disabled/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label for="certain-days-reccur-start">Powtarzaj od</label>
                                        <input type="date" class="datetime-input" id="certain-days-reccur-start" disabled />
                                    </div>
                                    <div class="col">
                                        <label for="certain-days-reccur-until">Powtarzaj do</label>
                                        <input type="date" class="datetime-input" id="certain-days-reccur-until" disabled/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="reminder" style="margin-bottom:20px">
                            <span class="form-subtitle">Przypomnienie</span>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col">
                                        <label for="certain-days-reminder-date">Data przypomnienia</label>
                                        <input type="datetime-local" class="datetime-input" id="certain-days-reminder-date" disabled />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="justify-content-center d-flex">
                            <button type="submit" class="violet-button" id="createOrEditCertainDaysButton"></button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="certain-days-task-details-container options-container" style="margin: 20px; display: none;">
                <div class="option-content" style="max-width: 600px;">
                    <div class="options-header">
                        <div class="previous-page" style="flex:1;">
                            <button class="violet-button" id="certain-days-task-details-previous-button" type="button" style="display: flex; align-items:center;" onclick="goBackToCertainDaysList()">
                                <span class="arrow-back" style="max-width:24px;"><img src="/icons/previous.png"></span>
                                <span>Powrót</span>
                            </button>
                        </div>
                        <div class="option-name" style="flex:auto; text-align:center;">
                            <span class="opion-name-placeholder" id="certain-days-details-window-title">Zadanie</span>
                        </div>
                        <div style="flex:1;"></div>
                    </div>
                    <hr />
                    <div class="certain-days-details-content-container" style="padding: 10px 30px 30px 30px;">
                        <div class="basic-data-details" style="margin-bottom: 20px">
                            <span class="form-subtitle">Podstawowe dane</span>
                            <div class="form-group" style="margin-top: 20px;">
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="certain-days-detail-label">Id:</label>
                                        <span class="details-span" id="certain-days-id-detail"></span>
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="certain-days-detail-label">Nazwa zadania:</label>
                                        <span class="details-span" id="certain-days-name-detail"></span>
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="certain-days-detail-label">Notatki:</label>
                                        <span class="details-span" id="certain-days-notes-detail"></span>
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="certain-days-detail-label">Priorytet:</label>
                                        <span class="details-span" id="certain-days-priority-detail"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="timeframes-details" style="margin-bottom: 20px">
                            <span class="form-subtitle">Ramy czasowe</span>
                            <div class="form-group" style="margin-top: 20px;">
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="certain-days-detail-label">Data zakończenia:</label>
                                        <span class="details-span" id="certain-days-due-date-detail"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="recurrence-details-certain" style="margin-bottom: 20px">
                            <span class="form-subtitle">Powtarzalność zadania</span>
                            <div class="form-group" style="margin-top: 20px;">
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="certain-days-detail-label">Jednostka czasu:</label>
                                        <span class="details-span" id="certain-days-recurrence-unit-detail"></span>
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="certain-days-detail-label">Interwał:</label>
                                        <span class="details-span" id="certain-days-recurrence-interval-detail"></span>
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="certain-days-detail-label">Początek powtarzania:</label>
                                        <span class="details-span" id="certain-days-recur-start-detail"></span>
                                    </div>
                                </div>
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="certain-days-detail-label">Koniec powtarzania:</label>
                                        <span class="details-span" id="certain-days-recur-stop-detail"></span>
                                    </div>
                                </div>
                            </div>
                            <hr />
                        </div>
                        <div class="reminder-details" style="margin-bottom: 20px">
                            <span class="form-subtitle">Przypomnienie</span>
                            <div class="form-group" style="margin-top: 20px;">
                                <div class="row mb-10">
                                    <div class="col d-flex">
                                        <label class="certain-days-detail-label">Data przypomnienia:</label>
                                        <span class="details-span" id="certain-days-reminder-detail"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    const priorityMappings = {
        0: "Niski",
        1: "Średni",
        2: "Wysoki",
        3: "Najwyższy"
    };

    const intervalUnitMappings = {
        0: "Dni",
        1: "Tygodnie",
        2: "Miesiące",
        3: "Lata"
    };

    $(document).ready(function () {

        initializeCalendar();

        getTodaysTasks();

        checkReminders();

        $(document).on('submit', '#add-edit-todays-task-form', function (e) {
            e.preventDefault();
            if ($("#createOrEditTodaysButton").attr("entity-id") != null) {
                var id = $("#createOrEditTodaysButton").attr("entity-id");
                updateTask(id, "todays");
            }
            else {
                addNewTask("todays", "CreateNewTask", true);
            }

            goBackToTodaysList();
        });

        $(document).on('submit', '#add-edit-certain-days-task-form', function(e) {
            e.preventDefault();
            if ($("#createOrEditCertainDaysButton").attr("entity-id") != null) {
                var id = $("#createOrEditCertainDaysButton").attr("entity-id");
                updateTask(id, "certain-days");
            }
            else {
                addNewTask("certain-days", "CreateNewTask", false);
            }

            goBackToCertainDaysList();
        });

        $(document).on('hidden.bs.modal', '#deleteEntityModal', function () {
            $('#confirmDelete').off('click');
            $('#denyDelete').off('click');
        });

        $(document).on('hidden.bs.modal', '#completeTaskModal', function () {
            $('#confirmComplete').off('click');
            $('#denyComplete').off('click');
        });

        $(document).on('click', '.complete-task-checkbox', function (e) {
            var checkbox = $(this);
            e.preventDefault();
            var id = $(this).attr("id").split('-')[1];

            $('#completeTaskModal').modal("show");

            $('#confirmComplete').on('click', function () {

                $.ajax({
                    url: '@Url.Action("FinishTask", "Endpoints")',
                    type: 'GET',
                    contentType: 'application/json',
                    data: { taskId: id },
                    success: function () {
                        $('td.centered-cell').find(`a[href="#edit-${id}"], a[href="#delete-${id}"]`).remove();
                    },
                    error: function (error) {
                        console.error(error.responseText);
                    }
                });

                checkbox.prop("disabled", true).prop("checked", true);
                $('#completeTaskModal').modal("hide");
            });

            $('#denyComplete').on('click', function () {

                $('#completeTaskModal').modal("hide");
            });
        });

        $(document).on('click', ".todays-details", function (e) {
            e.preventDefault();
            var id = $(this).attr('href').split('-')[1];


            $.ajax({
                url: '@Url.Action("GetTaskById", "Endpoints")',
                type: 'GET',
                contentType: 'application/json',
                data: { taskId: id },
                success: function (task) {
                    var priority = task.priority;
                    var intervalUnit = task.recurUnit

                    if (priority != null && priority in priorityMappings) {
                        priority = priorityMappings[priority];
                    }
                    if (intervalUnit != null || intervalUnit != undefined && intervalUnit in intervalUnitMappings) {
                        intervalUnit = intervalUnitMappings[intervalUnit];
                    }
                    if (intervalUnit == undefined || task.recurInterval == undefined || task.recurrenceStart == undefined) {
                        $(".recurrence-details").hide();
                    }

                    $('#todays-id-detail').html(`${task.id}`);
                    $('#todays-name-detail').html(`${task.name}`);
                    $('#todays-notes-detail').html(`${task.notes || "Brak notatek"}`);
                    $('#todays-priority-detail').html(`${priority || "Nie przypisano"}`);
                    $('#todays-due-date-detail').html(`${(task.dueDate == null || task.dueDate == undefined) ? "Nie określono" : new Date(task.dueDate).toLocaleString('pl-PL')}`);
                    $("#todays-recurrence-unit-detail").html(`${intervalUnit || "Nie wybrano"}`)
                    $('#todays-recurrence-interval-detail').html(`${task.recurInterval || "Nie wybrano"}`);
                    $('#todays-recur-start-detail').html(`${new Date(task.recurrenceStart).toLocaleString('pl-PL').split(',')[0] || "Nie wybrano"}`);
                    $('#todays-recur-stop-detail').html(`${new Date(task.recurUntil).toLocaleString('pl-PL').split(',')[0] || "Nie wybrano"}`);
                    $('#todays-reminder-detail').html(`${task.reminderTime == null ? "Nie ustawiono" : new Date(task.reminderTime).toLocaleString('pl-PL')}`);

                    $(".todays-task-details-container").show();
                    $(".today-container").hide();

                },
                error: function (error) {
                    console.error(error.responseText);
                }
            });
        });

        $(document).on('click', ".certain-days-details", function (e) {
            e.preventDefault();
            var id = $(this).attr('href').split('-')[1];


            $.ajax({
                url: '@Url.Action("GetTaskById", "Endpoints")',
                type: 'GET',
                contentType: 'application/json',
                data: { taskId: id },
                success: function (task) {
                    var priority = task.priority;
                    var intervalUnit = task.recurUnit

                    if (priority != null && priority in priorityMappings) {
                        priority = priorityMappings[priority];
                    }
                    if (intervalUnit != null || intervalUnit != undefined && intervalUnit in intervalUnitMappings) {
                        intervalUnit = intervalUnitMappings[intervalUnit];
                    }
                    if (intervalUnit == undefined || task.recurInterval == undefined || task.recurrenceStart == undefined) {
                        $(".recurrence-details-certain").hide();
                    }

                    $('#certain-days-id-detail').html(`${task.id}`);
                    $('#certain-days-name-detail').html(`${task.name}`);
                    $('#certain-days-notes-detail').html(`${task.notes || "Brak notatek"}`);
                    $('#certain-days-priority-detail').html(`${priority || "Nie przypisano"}`);
                    $('#certain-days-due-date-detail').html(`${(task.dueDate == null || task.dueDate == undefined) ? "Nie określono" : new Date(task.dueDate).toLocaleString('pl-PL')}`);
                    $("#certain-days-recurrence-unit-detail").html(`${intervalUnit || "Nie wybrano"}`)
                    $('#certain-days-recurrence-interval-detail').html(`${task.recurInterval || "Nie wybrano"}`);
                    $('#certain-days-recur-start-detail').html(`${new Date(task.recurrenceStart).toLocaleString('pl-PL').split(',')[0] || "Nie wybrano"}`);
                    $('#certain-days-recur-stop-detail').html(`${new Date(task.recurUntil).toLocaleString('pl-PL').split(',')[0] || "Nie wybrano"}`);
                    $('#certain-days-reminder-detail').html(`${task.reminderTime == null ? "Nie ustawiono" : new Date(task.reminderTime).toLocaleString('pl-PL')}`);

                    $(".certain-days-task-details-container").show();
                    $(".certain-days-container").hide();

                },
                error: function (error) {
                    console.error(error.responseText);
                }
            });
        });

        addListenersForForm("todays");
        addListenersForForm("certain-days");

        $(document).on('click', ".todays-delete", function (e) {
            e.preventDefault();
            var id = $(this).attr('href').split('-')[1];
            var thisElement = $(this);

            var name = $(this).closest('tr').find('.task-name').text()

            $("#modal-content-text").html(`Czy na pewno chcesz usunąć zadanie ${name}?`);
            $("#confirmDelete").html("Usuń zadanie");

            $('#deleteEntityModal').modal("show");

            $('#confirmDelete').on('click', function () {
                deleteTask(id);
                thisElement.closest('tr').remove();

                $('#deleteEntityModal').modal("hide");
            });

            $('#denyDelete').on('click', function () {

                $('#deleteEntityModal').modal("hide");
            });
        });

        $(document).on('click', ".todays-edit", function (e) {
            e.preventDefault();
            var id = $(this).attr('href').split('-')[1];

            $.ajax({
                url: '@Url.Action("GetTaskById", "Endpoints")',
                type: 'GET',
                contentType: 'application/json',
                data: { taskId: id },
                success: function (task) {

                    if(task.dueDate != null) {
                        $("#todays-recurrence-unit").prop('disabled', false);
                        $("#todays-reminder-date").prop('disabled', false);

                    }
                    if(task.recurUnit != undefined){
                        $("#todays-recurrence-interval").prop('disabled', false);
                        $("#todays-reccur-start").prop('disabled', false);
                        $("#todays-reccur-until").prop('disabled', false);
                    }

                    $("#todays-task-name").val(task.name);
                    $("#todays-task-priority").prop('selectedIndex', task.priority == null ? 0 : task.priority + 1);
                    $("#todays-task-notes").val(task.notes);
                    $("#todays-start-date").val(task.dueDate == null ? "" : task.dueDate);
                    $("#todays-recurrence-unit").prop('selectedIndex', task.recurUnit == undefined ? 0 : task.recurUnit + 1);
                    $("#todays-recurrence-interval").val(task.recurInterval == undefined ? "" : task.recurInterval);
                    $("#todays-reccur-start").val(task.recurrenceStart == undefined ? "" : task.recurrenceStart.split("T")[0]);
                    $("#todays-reccur-until").val(task.recurUntil == undefined ? "" : task.recurUntil.split("T")[0]);
                    $("#todays-reminder-date").val(task.reminderTime == null ? "" : task.reminderTime);

                    $("#todays-input-window-title").html("Edytuj zadanie");
                    $("#createOrEditTodaysButton").html("Edytuj");
                    
                    $(".today-container").hide();
                    $(".add-new-task").show();

                    $("#createOrEditTodaysButton").attr("entity-id", task.id);
                    
                },
                error: function (error) {
                        console.error(error.responseText);
                }
            });
        });

        $(document).on('click', ".certain-days-edit", function (e) {
            e.preventDefault();
            var id = $(this).attr('href').split('-')[1];

            $.ajax({
                url: '@Url.Action("GetTaskById", "Endpoints")',
                type: 'GET',
                contentType: 'application/json',
                data: { taskId: id },
                success: function (task) {

                    if(task.dueDate != null) {
                        $("#certain-days-recurrence-unit").prop('disabled', false);
                        $("#certain-days-reminder-date").prop('disabled', false);

                    }
                    if(task.recurUnit != undefined){
                        $("#certain-days-recurrence-interval").prop('disabled', false);
                        $("#certain-days-reccur-start").prop('disabled', false);
                        $("#certain-days-reccur-until").prop('disabled', false);
                    }

                    $("#certain-days-task-name").val(task.name);
                    $("#certain-days-task-priority").prop('selectedIndex', task.priority == null ? 0 : task.priority + 1);
                    $("#certain-days-task-notes").val(task.notes);
                    $("#certain-days-start-date").val(task.dueDate == null ? "" : task.dueDate);
                    $("#certain-days-recurrence-unit").prop('selectedIndex', task.recurUnit == undefined ? 0 : task.recurUnit + 1);
                    $("#certain-days-recurrence-interval").val(task.recurInterval == undefined ? "" : task.recurInterval);
                    $("#certain-days-reccur-start").val(task.recurrenceStart == undefined ? "" : task.recurrenceStart.split("T")[0]);
                    $("#certain-days-reccur-until").val(task.recurUntil == undefined ? "" : task.recurUntil.split("T")[0]);
                    $("#certain-days-reminder-date").val(task.reminderTime == null ? "" : task.reminderTime);

                    $("#certain-days-input-window-title").html("Edytuj zadanie");
                    $("#createOrEditCertainDaysButton").html("Edytuj");
                    
                    $(".certain-days-container").hide();
                    $(".add-new-task-certain-days").show();

                    $("#createOrEditCertainDaysButton").attr("entity-id", task.id);
                    
                },
                error: function (error) {
                        console.error(error.responseText);
                }
            });
        });

        OnInputFilterTable(".todays-task-search", "#todays-tasks-table");
        OnInputFilterTable(".certain-days-task-search", "#certain-days-tasks-table");

        document.querySelector('.bell').addEventListener('click', function () {
            // Toggle the 'show' class on the dropdown menu
            var dropdownMenu = this.nextElementSibling;
            dropdownMenu.classList.toggle('show');
        });

        // Close the dropdown menu if the user clicks outside of it
        window.addEventListener('click', function (event) {
            var dropdownContainer = document.querySelector('.dropdown');
            if (!dropdownContainer.contains(event.target)) {
                var dropdownMenus = document.querySelectorAll('.dropdown-menu');
                dropdownMenus.forEach(function (dropdownMenu) {
                    if (dropdownMenu.classList.contains('show')) {
                        dropdownMenu.classList.remove('show');
                    }
                });
            }
        });

    });


</script>

